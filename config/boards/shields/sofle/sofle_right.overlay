#include "sofle.dtsi"

/ {
    chosen {
        /* Matriz del escaneo de teclas */
        zmk,kscan = &kscan0;
        /* Asociación del underglow RGB */
        zmk,underglow = &ws2812_ug;
    };
};

/* --- Ajustes de transformación del lado izquierdo --- */
&default_transform {
    col-offset = <6>;
};

/* --- Definición de pines de columnas para el Sofle --- */
&kscan0 {
    col-gpios =
        <&pro_micro 10 GPIO_ACTIVE_HIGH>,
        <&pro_micro 16 GPIO_ACTIVE_HIGH>,
        <&pro_micro 14 GPIO_ACTIVE_HIGH>,
        <&pro_micro 15 GPIO_ACTIVE_HIGH>,
        <&pro_micro 18 GPIO_ACTIVE_HIGH>,
        <&pro_micro 19 GPIO_ACTIVE_HIGH>;
};

/* --- Habilitar encoder del lado derecho --- */
&right_encoder {
    status = "okay";
};

/* --- Configuración del underglow (LED strip SK6812) --- */
&ws2812_ug {
    compatible = "worldsemi,sk6812-spi";
    label = "LED Strip";

    /* Número total de LEDs del Sofle RGB v2.1 */
    chain-length = <72>;

    /* Frecuencia SPI segura para nRF52840 */
    spi-max-frequency = <4000000>;

    /* ⚠️ Prueba primero con P0.06 (recomendado por ZMK para Mikoto)
       Si no funciona, cambia por una de estas opciones:
       - <&gpio0 15 GPIO_ACTIVE_HIGH>
       - <&gpio1 2 GPIO_ACTIVE_HIGH>
       - <&gpio1 8 GPIO_ACTIVE_HIGH>
    */
    data-gpios = <&gpio0 6 GPIO_ACTIVE_HIGH>;

    /* Mapeo de color RGB (sin canal blanco) */
    color-mapping = <LED_COLOR_MAPPING_RGB>;

    /* Opcional: efectos extendidos */
    status = "okay";
};
